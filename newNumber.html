<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html {
      background-color: rgb(170, 210, 210);
    }

    #title {
      text-align: center;
      margin-bottom: 0.5em;
      font-weight: bold;
    }

    #input {
      display: block;
      width: 3em;
      margin: 0 auto 0.1em;
      text-align: center;
      border-radius: 11px;
      border: black solid 1px;
      outline: none;
    }

    #input:focus:not([readonly]) {
      border: blue solid 1px;
    }

    #input[readonly] {
      background-color: lightgrey;
    }

    #button {
      display: block;
      margin: auto;
      width: 10em;
      background-color: rgb(235, 235, 235);
      border: outset 3px;
      outline: none;
    }

    #button:active {
      border: inset 3px;
    }

    #button>span {
      display: inline-block;
    }

    #l {
      float: left;
    }

    #r {
      float: right;
    }

    .display {
      margin: 0.5em auto;
      height: 1.2em;
      text-align: center;
    }

    .display>span {
      display: inline-block;
      vertical-align: top;
    }

    .maru {
      display: inline-block;
      border-radius: 50%;
      background-color: red;
      margin-left: 1.3em;
    }

    .sankaku {
      display: inline-block;
      width: 0;
      height: 0;
      border-style: solid;
      border-color: transparent transparent blue;
      margin-left: 0.7em;
    }

    #one {
      font-size: 20px;
      margin: auto;
      display: block;
      border: purple solid 2px;
      border-radius: 10px;
      width: 6em;
      background-color: white;
      color: purple;
    }
  </style>
  <title>数字あてゲーム</title>
</head>

<body>
  <style id="style"></style>
  <div id="title">数字あてゲーム</div>
  <div><input type="text" id="input" maxlength="3" autocomplete="off"></div>
  <button id="button"><span><span id="l">↓</span>解答<span id="r">↓</span></span></button>
  <div id="area"></div>


  <script>
    const sm = navigator.userAgent.match(/(iPhone|iPad|iPod|Android)/i);
    document.getElementById('style').innerHTML = `
      #title {
        font-size: ${sm ? 20 : 28}px;
      }
      #input {
        font-size: ${sm ? 20 : 32}px;
      }
      #button {
        font-size: ${sm ? 12 : 20}px;
      }
      #button > span {
        width: ${sm ? 90 : 140}px;
      }
      .display{
        font-size: ${sm ? 16 : 32}px;
      }
      .display > span {
        line-height: ${sm ? 20 : 40}px;
      }
      .maru {
        width: ${sm ? 16 : 32}px;
        height: ${sm ? 16 : 32}px;
      }
      .sankaku {
        border-width: 0 ${sm ? 10 : 19}px ${sm ? 16 : 32}px;
      }
      #one {
        font-size: ${sm ? 10 : 20}px;
        border-radius: ${sm ? 5 : 10}px;
      }
    `;

    const input = document.getElementById('input');
    const button = document.getElementById('button');
    const area = document.getElementById('area');

    let number = [1, 2, 3, 4, 5, 6, 7, 8, 9];
    let anser = '';
    for (let i = 0; i < 3; i++) {
      let random = number[Math.floor(Math.random() * (9 - i))]
      anser += random;
      number.splice(number.indexOf(random), 1);
    }

    button.onclick = () => {
      click();
    }

    input.onkeydown = (e) => {
      if (e.keyCode == 13) click();
    }

    let color = '';
    const click = () => {
      if (input.readOnly == true) return;
      let n = input.value;
      if (isNaN(n) || n.length != 3 || n[0] == n[1] || n[0] == n[2] || n[1] == n[2] || -1 < n.indexOf(0)) {
        alert('できません');
      } else {
        let o = 0;
        let x = 0;
        a: for (let i = 0; i < 3; i++) {
          let n1 = n[i];
          for (let j = 0; j < 3; j++) {
            let a1 = anser[j];
            if (n1 == a1) {
              if (i == j) {
                o++;
                color += 2;
                continue a;
              } else {
                x++;
                color += 1;
                continue a;
              }
            } else if (j == 2) {
              color += 0;
            }
          }
        }

        area.innerHTML += `<div class="display"><span><span class="color">${n[0]}</span><span class="color">${n[1]}</span><span class="color">${n[2]}</span></span><div class="maru"></div><span>${o}</span><div class="sankaku"></div><span>${x}</span></div>`;
        if (o == 3) {
          input.readOnly = true;
          alert(`正解!!\n記録は${color.length / 3}回`);
          const c = document.getElementsByClassName('color');
          for (let i = 0; i < color.length; i++) {
            c[i].style.color = color[i] == 2 ? 'red' : color[i] == 1 ? 'blue' : 'black';
          }
          area.innerHTML += '<button id="one">もう一度</button>';
          document.getElementById('one').onclick = () => {
            location.reload();
          }
        }

      }
      input.value = '';
    }



  </script>
</body>

</html>
